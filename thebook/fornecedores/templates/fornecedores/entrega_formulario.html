{% extends "base/main.html" %}

{% block content %}
  <div class="d-sm-flex align-items-center justify-content-between mb-4">
    <div>
      <h1 class="h3 mb-0 text-gray-800">{{ titulo }}</h1>
      <p class="text-muted mt-2 mb-0">
        Registre cada fornecimento para acompanhar histórico, qualidade percebida e custos aproximados.
      </p>
    </div>
    <a class="btn btn-secondary" href="{% url 'fornecedores:detalhar' fornecedor.id %}">
      <i class="fas fa-arrow-left mr-1"></i> Voltar para o fornecedor
    </a>
  </div>

  <div id="entregaFormContainer">
    <div class="card shadow mb-4">
      <div class="card-header py-3">
        <h6 class="m-0 font-weight-bold text-primary">Dados da Entrega</h6>
      </div>
      <div class="card-body">
        <form
          method="post"
          novalidate
          hx-post="{% if entrega %}{% url 'fornecedores:entrega-editar' fornecedor.id entrega.id %}{% else %}{% url 'fornecedores:entrega-criar' fornecedor.id %}{% endif %}"
          hx-target="#entregaFormContainer"
          hx-swap="outerHTML"
          hx-indicator="#loadingSpinner"
        >
          {% csrf_token %}

          <div class="form-group">
            <label for="{{ form.titulo.id_for_label }}">O que foi entregue</label>
            {{ form.titulo }}
            {% include "fornecedores/partials/_help_and_errors.html" with field=form.titulo %}
          </div>

          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label for="{{ form.valor_estimado.id_for_label }}">Valor (opcional)</label>
                {{ form.valor_estimado }}
                {% include "fornecedores/partials/_help_and_errors.html" with field=form.valor_estimado %}
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label for="{{ form.data_entrega.id_for_label }}">Data da entrega</label>
                {{ form.data_entrega }}
                {% include "fornecedores/partials/_help_and_errors.html" with field=form.data_entrega %}
              </div>
            </div>
          </div>

          <div class="form-group">
            <label for="{{ form.qualidade.id_for_label }}">Qualidade percebida</label>
            {{ form.qualidade }}
            {% include "fornecedores/partials/_help_and_errors.html" with field=form.qualidade %}
          </div>

          <div class="form-group">
            <label for="{{ form.descricao.id_for_label }}">Detalhes</label>
            {{ form.descricao }}
            {% include "fornecedores/partials/_help_and_errors.html" with field=form.descricao %}
          </div>

          <div class="form-group mb-4">
            <label for="{{ form.observacoes.id_for_label }}">Observações adicionais</label>
            {{ form.observacoes }}
            {% include "fornecedores/partials/_help_and_errors.html" with field=form.observacoes %}
          </div>

          <div class="text-right">
            <a href="{% url 'fornecedores:detalhar' fornecedor.id %}" class="btn btn-secondary mr-2">
              Cancelar
            </a>
            <span id="loadingSpinner" class="htmx-indicator mr-2">
              <i class="fas fa-spinner fa-spin"></i>
            </span>
            <button type="submit" class="btn btn-success">
              {% if entrega %}Atualizar entrega{% else %}Salvar entrega{% endif %}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
{% endblock content %}
